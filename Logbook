ssh -l fpitsill -J fpitsill@knuckles.cs.ucl.ac.uk pchuckle
#enter password 4/10/21

cd /SAN/ugi/LepGenomics #access shared folder
mkdir C3_Aricia_agestis_FP #created new folder 

#13/10/21

#PRENAME
mkdir scripts
nano prename.pl
/share/apps/perl-5.30.0/bin/perl5.30.0 ../../prename.pl --help
prename.pl
ls prename.pl
nano prename.pl


#COPIED ALL DATA FROM C3_Aricia_agestis TO C3_Aricia_agestis_FP

    #Museum1 (190312)
cp *gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum
cp *log /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum
cp *html /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum
            #Example file: AAg-19-1900-02_190312_L005_R1.fastq.gz 

    #Museum2 (191121)
cp *zip /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum2 
cp *log /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum2
cp *html /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum2
            #Example file: AAg-19-1900-04_191121_L003_R1.fastq.gz 

    #Modern1 (L002)
cp *gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_modern

    #Modern2_exp (L001)
cp *gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_modern_exp


#CONCATENATE MUSEUM SAMPLES

mkdir 00_raw_reads_museum_FINAL/
ls 00_raw_reads_museum/*R1*gz | awk -F "/" '{print $NF}' | awk -F "_" '{print $1}' > museum1.names
ls 00_raw_reads_museum/ALLSAMPLES/*R1*gz | awk -F "/" '{print $NF}' | awk -F "_" '{print $1}' > museumconcat.names
diff museum1.names museumconcat.names | grep 'AAg' | sed 's/^>\ //'> museum1.tomove
wc -l museum1.tomove > count
echo "number of samples to move:" $count
for i in $(cat museum1.tomove); do cp 00_raw_reads_museum/ALLSAMPLES/$i*gz 00_raw_reads_museum_FINAL; done



#14/10/21

#CUTADAPT ON 5 MUSEUM1 SAMPLES

mkdir 00_raw_reads_museum_sample 
cp 01a_museum1_cutadapt_filtering_trimming.sh /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/DATA/00_raw_reads_museum_sample
nano 01a_museum1_cutadapt_filtering_trimming.sh #Changed species name to C3_Aricia_agestis_FP, and Infile/outfile and species number by changing -t from 48 to 5
./01a_museum1_cutadapt_filtering_trimming.sh  #outputs command used to submit job to the cluster
qsub /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/01a_filtered_reads_museum_sample/parallel_cutadapt.20211014-125514.smsjob.sh #job submitted to cluster
qstat #to check the status of the job

#CUTADAPT ON 2 MODERN SAMPLES

mkdir 00_raw_reads_modern_exp_sample
cp AAg-19-2016-01_L002_R1.fastq.gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_exp_sample
cp AAg-19-2016-02_L002_R1.fastq.gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_exp_sample
cp 01a_modern_cutadapt_filtering_trimming.sh /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_exp_sample
nano 01a_modern_cutadapt_filtering_trimming.sh #Changed species name to C3_Aricia_agestis_FP and species number by changing -t from 48 to 5
./01a_modern_cutadapt_filtering_trimming.sh
qsub /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_sample/01a_modern_cutadapt_reads/parallel_cutadapt.20211014-210144.smsjob.sh
qstat

#15/10/21

#CUTADAPT on 2 MODERN SAMPLES RE-ATTEMPT

cp AAg-19-2016-01_L001_R*.fastq.gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_sample
mkdir cutadapt_modern_test_output
 nano cutadapt_script_test.sh
 
                ##EDITED FILE
                               SHAREDFOLDER=/SAN/ugi/LepGenomics
                            SCRIPTS=VelocityPipeline/tools
                            SPECIES=C3_Aricia_agestis_FP
                            INFILE=00_raw_reads_modern_sample
                            OUTFILE=00_raw_reads_modern_sample/cutadapt_modern_test_output

                            $SHAREDFOLDER/$SCRIPTS/01a_parallel_cutadapt_UCL.sh \
                            -i $SHAREDFOLDER/$SPECIES/$INFILE \
                            -o $SHAREDFOLDER/$SPECIES/$OUTFILE -t 2 -m 8 -ph 33 \
                            -fwad1 AGATCGGAAGAGCACACGTCTGAACTCCAGTC -rvad1 AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT \
                            -minl 20 -phredq 20;
                            
./cutadapt_script_test.sh 
qsub /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_sample/cutadapt_modern_test_output/parallel_cutadapt.20211015-193411.smsjob.sh
parallel_cutadapt.20211015-193411 - job name/number


#CHECKING JOB STATUS

    #1 Go to output directory specified in the .sh script
    #2 Go to the log file
    #3 The title of the log file gives the name of the job, in the format "jobname".o"jobnumber"."arraynumber", eg parallel_cutadapt.20211015-193411
    #4 move to the home directory using cd and check what log files have written and at what time using ls -ltr *.o*
  

#17/10/21

#Cutadapt sample museum 
cp AAg-19-2016-01_L001_R*.fastq.gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_modern_sample
cp AAg-19-1900-03_190312_L005_R*.fastq.gz /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_museum_sample
mkdir 01a_museum_cutadapt_reads
nano 01a_museum1_cutadapt_filtering_trimming.sh 

            #Output: 
                        #!/bin/bash
                        ##################################
                        # Alexandra Jansen van Rensburg
                        # alexjvr@gmail.com
                        # Last modified 06/07/2021 11:22
                        ##################################

                        # Creates submission script to use cutadapt to remove adapters from demultiplexed Illumina libraries.
                        # Poly-A and -T filters have been removed as we decided that these would be dropped due to mapping quality by bwa mem.
                        # Additional filters included in Lymantria monacha dataset
                        # -fwad2 CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT -fwad3 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
                        # -rvad2 CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT -rvad3 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

                        SHAREDFOLDER=/SAN/ugi/LepGenomics
                        SCRIPTS=VelocityPipeline/tools
                        SPECIES=C3_Aricia_agestis_FP
                        INFILE=00_raw_reads_museum_sample
                        OUTFILE=00_raw_reads_museum_sample/01a_museum_cutadapt_reads

                        $SHAREDFOLDER/$SCRIPTS/01a_parallel_cutadapt_UCL.sh \
                        -i $SHAREDFOLDER/$SPECIES/$INFILE \
                        -o $SHAREDFOLDER/$SPECIES/$OUTFILE -t 4 -m 8 -ph 33 \
                        -fwad1 AGATCGGAAGAGCACACGTCTGAACTCCAGTC -rvad1 AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT \
                        -minl 20 -phredq 20;


./01a_museum1_cutadapt_filtering_trimming.sh
qsub /SAN/ugi/LepGenomics/C3_Aricia_agestis_FP/00_raw_reads_museum_sample/01a_museum_cutadapt_reads/parallel_cutadapt.20211017-122826.smsjob.sh
qstat #Started at 12.30





