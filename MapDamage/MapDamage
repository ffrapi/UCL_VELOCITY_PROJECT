#MAP DAMAGE for museum samples

#OVERVIEW: MapDamage2 is a package used to estimate and correct for Cytosine deamination (or any other transition/transversion bias in the data). 
#This is a problem anticipated for ancient DNA, and possibly for museum data.
#mapDamage2 is a computational framework written in Python and R, which tracks and quantifies DNA damage patterns among ancient DNA sequencing reads generated by Next-Generation Sequencing platforms.
#Paper Map_damage2.0 has good information about degradation of DNA in historical samples
#Expected patterns in museum data: observed inflated cytosine deamination rates at 5'-overgangs, an increase in C-T substitution rates toward sequencing starts and complementary increase in G-A rates towards reads ends.
#Output pdf's are good for this - compare modern and museum data 
https://ginolhac.github.io/mapDamage/#a2

#SOFTWARE: MapDamage2.0
JÃ³nsson H, Ginolhac A, Schubert M, Johnson P, Orlando L. mapDamage2.0: fast approximate Bayesian estimates of ancient DNA damage parameters. Bioinformatics 2013. 23rd April 2013. doi: 10.1093/bioinformatics/btt193
Ginolhac A, Rasmussen M, Gilbert MT, Willerslev E, Orlando L. mapDamage: testing for damage patterns in ancient DNA sequences. Bioinformatics 2011 27 (15):2153-2155


#INPUT: realn.bam files
#OUTPUT: rescaled.bam files, .txt, .pdf, .csv files:
When all options are activated, 16 files are produced in the result folder.

Runtime_log.txt, log file with a summary of command lines used and timestamps.
For the plotting:

Fragmisincorporation_plot.pdf, a pdf file that displays both fragmentation and misincorporation patterns.
Length_plot.pdf, a pdf file that displays length distribution of singleton reads per strand and cumulative frequencies of C->T at 5'-end and G->A at 3'-end are also displayed per strand.
Important remark: paired-ended reads are not considered for this analysis since the plot displays the distribution of read lengths and not insert sizes of paired-ended reads. For this last purpose, one can use the dedicated Picard tool CollectInsertSizeMetrics.
misincorporation.txt, contains a table with occurrences for each type of mutations and relative positions from the reads ends.
5pCtoT_freq.txt, contains frequencies of Cytosine to Thymine mutations per position from the 5'-ends.
3pGtoA_freq.txt, contains frequencies of Guanine to Adenine mutations per position from the 3'-ends.
dnacomp.txt, contains a table of the reference genome base composition per position, inside reads and adjacent regions.
lgdistribution.txt, contains a table with read length distributions per strand.
For the statistical estimation:

Stats_out_MCMC_hist.pdf, MCMC histogram for the damage parameters and log likelihood.
Stats_out_MCMC_iter.csv, values for the damage parameters and log likelihood in each MCMC iteration.
Stats_out_MCMC_trace.pdf, a MCMC trace plot for the damage parameters and log likelihood.
Stats_out_MCMC_iter_summ_stat.csv, summary statistics for the damage parameters estimated posterior distributions.
Stats_out_post_pred.pdf, empirical misincorporation frequency and posterior predictive intervals from the fitted model.
Stats_out_MCMC_correct_prob.csv, position specific probability of a C->T and G->A misincorporation is due to damage.
dnacomp_genome.txt, contains the global reference genome base composition (computed by seqtk).
Rescaled BAM file, where likely post-mortem damaged bases have downscaled quality scores.


#STEPS: 
#1: Create file list containing the realn.bam files 
#2: Edit script
#3: Move all rescaled.bam files to a new folder
#4: Index rescaled.bam files
#5: Plot graphs

https://ginolhac.github.io/mapDamage/#Fragmisincorporation_plot
